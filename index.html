<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Weekend Rotation</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1, h2 {
      margin-bottom: 0.3rem;
    }
    label {
      display: inline-block;
      width: 180px;
      margin-bottom: 0.4rem;
    }
    input {
      margin-bottom: 0.4rem;
    }
    button {
      margin-right: 10px;
      margin-top: 10px;
    }
    table {
      border-collapse: collapse;
      margin-top: 10px;
      width: 100%;
      max-width: 900px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px 8px;
      text-align: left;
    }
    th {
      background: #f5f5f5;
    }
    .week-block {
      margin-bottom: 25px;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 6px;
    }
    .day-title {
      margin-top: 8px;
      font-weight: bold;
    }
    .small {
      font-size: 0.8rem;
      color: #555;
    }
  </style>
</head>
<body>
  <h1>Weekend Rotation</h1>
  <p class="small">

  </p>

  <div>
    <label for="startDate">Start date (Saturday):</label>
    <input type="date" id="startDate" />
    <br />
    <label for="numWeeks">Number of weeks:</label>
    <input type="number" id="numWeeks" value="12" min="1" max="52" />
    <br />
    <label for="satCount">Saturday headcount:</label>
    <input type="number" id="satCount" value="6" min="1" max="10" />
    <br />
    <label for="sunCount">Sunday headcount:</label>
    <input type="number" id="sunCount" value="5" min="1" max="10" />
    <br />
    <button onclick="generateSchedule()">Generate schedule</button>
    <button onclick="window.print()">Print / Save to PDF</button>
  </div>

  <div id="output"></div>

  <script>
    // ======== CONFIGURABLE LISTS ========
    // Core-ish weekend folks you tend to see a lot
    const coreWeekend = [
      "Madeline",
      "Kathy",
      "Sarah",
      "Bridgette",
      "Paige"
    ];

    // Non-core / rotating folks â€” add/remove to match your store
    const nonCoreWeekend = [
      "Holli",
      "Hannah",
      "Rebecca",
      "Kelsey",
      "Dana",
      "Nathaniel",
      "Carl",
      "Eric"
    ];

    
    const specialName = "Holli";





    function pickLeastUsed(candidates, usageMap, avoidSet = new Set()) {
      let best = null;
      let bestCount = Infinity;

      candidates.forEach((name) => {
        if (avoidSet.has(name)) return;
        const count = usageMap[name] || 0;
        if (count < bestCount) {
          best = name;
          bestCount = count;
        }
      });

      return best;
    }

    function addDays(date, days) {
      const result = new Date(date);
      result.setDate(result.getDate() + days);
      return result;
    }

    function formatDate(date) {
      return date.toISOString().split("T")[0];
    }

    function generateSchedule() {
      const startDateInput = document.getElementById("startDate").value;
      const numWeeks = parseInt(document.getElementById("numWeeks").value, 10);
      const satCount = parseInt(document.getElementById("satCount").value, 10);
      const sunCount = parseInt(document.getElementById("sunCount").value, 10);

      const outputDiv = document.getElementById("output");
      outputDiv.innerHTML = "";

      if (!startDateInput) {
        outputDiv.innerHTML = "<p>Please pick a start date (the first Saturday).</p>";
        return;
      }

      const startDate = new Date(startDateInput);

      // usageMap counts TOTAL weekend appearances (Sat + Sun) for fairness
      const usageMap = {};

      // ensure every name is at least in the map
      const everyone = Array.from(new Set([...coreWeekend, ...nonCoreWeekend]));
      everyone.forEach((name) => (usageMap[name] = 0));

      let html = "";

      for (let week = 0; week < numWeeks; week++) {
        const thisSat = addDays(startDate, week * 7);       // Saturday
        const thisSun = addDays(startDate, week * 7 + 1);   // Sunday

        // We'll build arrays of assignments
        const satAssignments = [];
        const sunAssignments = [];

        // We use this to avoid putting the same person in Sat AND Sun of the same week
        const usedThisWeek = new Set();

        

        if (week % 6 === 0) {
          satAssignments.push(specialName);
          usageMap[specialName] = (usageMap[specialName] || 0) + 1;
          usedThisWeek.add(specialName);
        }

        // Fill the rest of Saturday
        while (satAssignments.length < satCount) {
          // First try core then non-core, but always by least used
          const candidate = pickLeastUsed(everyone, usageMap, usedThisWeek);
          if (!candidate) break; // nothing left
          satAssignments.push(candidate);
          usageMap[candidate] = (usageMap[candidate] || 0) + 1;
          usedThisWeek.add(candidate);
        }

       

        if (week % 6 === 3 && !usedThisWeek.has(specialName)) {
          sunAssignments.push(specialName);
          usageMap[specialName] = (usageMap[specialName] || 0) + 1;
          usedThisWeek.add(specialName);
        }

        // Fill the rest of Sunday
        while (sunAssignments.length < sunCount) {
          const candidate = pickLeastUsed(everyone, usageMap, usedThisWeek);
          if (!candidate) break;
          sunAssignments.push(candidate);
          usageMap[candidate] = (usageMap[candidate] || 0) + 1;
          usedThisWeek.add(candidate);
        }

        // Build HTML for this week
        html += `<div class="week-block">`;
        html += `<h2>Week ${week + 1}</h2>`;
        html += `<p class="small">Saturday: ${formatDate(thisSat)} &nbsp; | &nbsp; Sunday: ${formatDate(thisSun)}</p>`;

        // Saturday table
        html += `<div class="day-title">Saturday (${satAssignments.length}):</div>`;
        html += `<table><tr><th>#</th><th>Employee</th></tr>`;
        satAssignments.forEach((name, idx) => {
          html += `<tr><td>${idx + 1}</td><td>${name}</td></tr>`;
        });
        html += `</table>`;

        // Sunday table
        html += `<div class="day-title">Sunday (${sunAssignments.length}):</div>`;
        html += `<table><tr><th>#</th><th>Employee</th></tr>`;
        sunAssignments.forEach((name, idx) => {
          html += `<tr><td>${idx + 1}</td><td>${name}</td></tr>`;
        });
        html += `</table>`;

        html += `</div>`;
      }

      // At the bottom, show usage summary so you can eyeball fairness
      html += `<h2>Usage Summary</h2>`;
      html += `<table><tr><th>Employee</th><th>Total weekend shifts</th></tr>`;
      // sort by usage ascending to see who got the fewest
      const sortedUsage = Object.entries(usageMap).sort((a, b) => a[1] - b[1]);
      sortedUsage.forEach(([name, count]) => {
        html += `<tr><td>${name}</td><td>${count}</td></tr>`;
      });
      html += `</table>`;

      outputDiv.innerHTML = html;
    }

    // Optional: set today as default start date if it's empty
    window.addEventListener("load", () => {
      const startDateInput = document.getElementById("startDate");
      if (!startDateInput.value) {
        const today = new Date();
        // default to upcoming Saturday
        const day = today.getDay(); // 0=Sun ... 6=Sat
        const diffToSat = (6 - day + 7) % 7;
        const upcomingSat = new Date(today);
        upcomingSat.setDate(today.getDate() + diffToSat);
        startDateInput.value = upcomingSat.toISOString().split("T")[0];
      }
    });
  </script>
</body>
</html>
